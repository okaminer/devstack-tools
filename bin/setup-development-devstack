#!/bin/bash
#
# Sets up a devstack instance, using a specific repo and branch of cinder

# defaults
WORKSPACE="$HOME/workspace"
PYTHON="/usr/bin/python3"
# these should be exported prior to invoking this script
# export CINDER_REPO="https://github.com/tssgery/cinder.git"
# export CINDER_BRANCH="master"
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
PROJECT_DIR="$( cd "$( dirname "${SCRIPT_DIR}" )" && pwd )"

# Make sure only root can run our script
if [ "$(id -u)" != "0" ]; then
   echo "This script must be run as root" 1>&2
   exit 1
fi

# check what operating system I am on
VARIANT=`lsb_release -si`
if [ $? -ne 0 ]; then
  VARIANT="CentOS"
  echo "lsb_release was not found, assuming ${VARIANT}"
fi

if [ "${VARIANT}" == "Ubuntu" ]; then
  echo "Installing dependencies"
  apt-get install -y \
     build-essential \
     libpq-dev \
     openssh-server \
     python2.7-dev \
     python3-dev \
     virtualenv
elif [ "${VARIANT}" == "CentOS" ]; then
  echo "Running on CentOS, unsupported"
  exit 1
else
  echo "Unknown linux variant: ${VARIANT}, unsupported"
  exit 1
fi

${SCRIPT_DIR}/setup-devstack


exit 0
